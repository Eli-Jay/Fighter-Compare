name: Build macOS .app

on:
  workflow_dispatch:

jobs:
  mac:
    runs-on: macos-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install -U pip
          python -m pip install pyside6 pyinstaller

      - name: Build app
        run: |
          pyinstaller --noconfirm --clean --windowed --name "FighterCompare" \
            --add-data "fighters.ui:." \
            --add-data "fighters.csv:." \
            FighterCompare.py

      - name: Zip .app
        run: |
          ditto -c -k --sequesterRsrc --keepParent "dist/FighterCompare.app" "FighterCompare-mac.zip"

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: FighterCompare-mac
          path: FighterCompare-mac.zip
